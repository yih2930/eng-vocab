<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ëã±ÂçòË™û„Éú„Ç≠„É£„Éñ„É©500</title>
    <script src="data.js"></script>
    <style>
        :root { --primary: #4A90E2; --success: #47C78E; --error: #FF6B6B; --bg: #F0F2F5; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 15px; display: flex; justify-content: center; }
        .container { background: white; width: 100%; max-width: 500px; border-radius: 20px; box-shadow: 0 8px 30px rgba(0,0,0,0.1); padding: 20px; min-height: 90vh; display: flex; flex-direction: column; box-sizing: border-box; }
        h2 { text-align: center; color: #333; font-size: 1.2rem; }
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .chapter-btn { padding: 15px; border: 1px solid #DDD; border-radius: 12px; background: white; text-align: left; cursor: pointer; position: relative; }
        .chapter-btn .date { font-size: 0.7rem; color: #888; display: block; margin-top: 5px; }
        .chapter-btn.done { border-color: var(--success); background: #F6FFF9; }
        .review-btn { background: #666; color: white; padding: 15px; border-radius: 12px; text-align: center; margin-top: 20px; font-weight: bold; width: 100%; border: none; cursor: pointer; }
        
        .quiz-header { display: flex; justify-content: space-between; font-size: 0.8rem; color: #888; margin-bottom: 15px; }
        .jp { font-size: 1.3rem; font-weight: bold; margin-bottom: 20px; color: #333; min-height: 3rem; }
        .options { display: grid; gap: 10px; }
        .opt-btn { padding: 14px; border: 2px solid #EEE; border-radius: 12px; background: white; font-size: 1rem; text-align: left; cursor: pointer; transition: 0.2s; }
        .feedback { margin-top: 15px; padding: 15px; border-radius: 12px; display: none; background: #F9F9F9; border: 1px solid #EEE; }
        .feedback.show { display: block; }
        .phrase { font-style: italic; margin: 10px 0; font-size: 1.1rem; color: #000; line-height: 1.4; }
        .voice-btn { background: #666; color: white; border: none; padding: 10px 18px; border-radius: 20px; cursor: pointer; margin-bottom: 10px; }
        
        .hidden { display: none; }
        .result-screen { text-align: center; padding: 20px; }
        .score { font-size: 3rem; font-weight: bold; color: var(--primary); }
    </style>
</head>
<body>
<div class="container">
    <div id="menu-screen">
        <h2>Á´†„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</h2>
        <div id="chapter-list" class="menu-grid"></div>
        <div id="review-area"></div>
    </div>

    <div id="quiz-screen" class="hidden">
        <div class="quiz-header">
            <span id="current-info"></span>
            <span id="progress-text"></span>
        </div>
        <div id="sit" style="color:var(--primary); font-weight:bold; font-size:0.85rem; margin-bottom:5px;"></div>
        <div id="jp" class="jp"></div>
        <div id="opts" class="options"></div>
        <div id="fb" class="feedback">
            <div id="res" style="font-weight:bold; font-size:1.1rem; margin-bottom:8px;"></div>
            <div id="phrase" class="phrase"></div>
            <button class="voice-btn" onclick="speakCurrent()">üîä Áô∫Èü≥„ÇíËÅû„Åè</button>
            <button onclick="nextQuestion()" style="width:100%; padding:15px; background:var(--success); color:white; border:none; border-radius:12px; font-weight:bold; cursor:pointer; font-size:1rem; margin-top:10px;">Ê¨°„ÅÆÂïèÈ°å„Å∏</button>
        </div>
    </div>

    <div id="result-screen" class="result-screen hidden">
        <h2>Chapter „ÇØ„É™„Ç¢ÔºÅ</h2>
        <div class="score" id="final-score">0 / 0</div>
        <button onclick="showMenu()" style="width:100%; padding:15px; background:var(--primary); color:white; border:none; border-radius:12px; font-weight:bold; margin-top:20px; cursor:pointer;">„É°„Éã„É•„Éº„Å´Êàª„Çã</button>
    </div>
</div>

<script>
let currentChapter = 0;
let currentIndex = 0;
let score = 0;
let quizPool = [];
let mistakes = JSON.parse(localStorage.getItem('mistakes') || '[]');
let history = JSON.parse(localStorage.getItem('history') || '{}');

function showMenu() {
    document.getElementById('menu-screen').classList.remove('hidden');
    document.getElementById('quiz-screen').classList.add('hidden');
    document.getElementById('result-screen').classList.add('hidden');
    
    const list = document.getElementById('chapter-list');
    list.innerHTML = '';
    // ÂÖ®25Á´†„ÅÆ„Éú„Çø„É≥„Çí‰ΩúÊàê
    for (let i = 1; i <= 25; i++) {
        const btn = document.createElement('div');
        const isDone = history[i];
        btn.className = `chapter-btn ${isDone ? 'done' : ''}`;
        btn.innerHTML = `Á¨¨${i}Á´† ${isDone ? '<span class="date">Ê∏à: ' + isDone + '</span>' : ''}`;
        btn.onclick = () => startChapter(i);
        list.appendChild(btn);
    }

    const reviewArea = document.getElementById('review-area');
    reviewArea.innerHTML = mistakes.length > 0 ? 
        `<button class="review-btn" onclick="startReview()">Âæ©Áøí„É¢„Éº„Éâ (${mistakes.length}Ë™û)</button>` : '';
}

function startChapter(chapterNum) {
    if(!allChapters[chapterNum]) {
        alert("Á¨¨" + chapterNum + "Á´†„ÅÆ„Éá„Éº„Çø„ÅØ„Åæ„Å†ËøΩÂä†„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºÅ");
        return;
    }
    currentChapter = chapterNum;
    quizPool = [...allChapters[chapterNum]].sort(() => Math.random() - 0.5);
    initQuiz();
}

function startReview() {
    currentChapter = 'Âæ©Áøí';
    quizPool = [...mistakes].sort(() => Math.random() - 0.5);
    initQuiz();
}

function initQuiz() {
    currentIndex = 0;
    score = 0;
    document.getElementById('menu-screen').classList.add('hidden');
    document.getElementById('quiz-screen').classList.remove('hidden');
    loadQuestion();
}

function loadQuestion() {
    const q = quizPool[currentIndex];
    document.getElementById('current-info').innerText = currentChapter === 'Âæ©Áøí' ? 'Âæ©Áøí„É¢„Éº„Éâ' : `Chapter ${currentChapter}`;
    document.getElementById('progress-text').innerText = `${currentIndex + 1} / ${quizPool.length}`;
    document.getElementById('sit').innerText = q.s;
    document.getElementById('jp').innerText = q.j;
    document.getElementById('fb').classList.remove('show');
    
    const opts = document.getElementById('opts');
    opts.innerHTML = '';
    const choices = [q.e, ...q.d].sort(() => Math.random() - 0.5);
    choices.forEach(o => {
        const b = document.createElement('button');
        b.className = 'opt-btn'; b.innerText = o;
        b.onclick = () => checkAnswer(o, q.e, b);
        opts.appendChild(b);
    });
}

function checkAnswer(selected, correct, btn) {
    const isCorrect = selected === correct;
    const q = quizPool[currentIndex];
    
    // ÂÖ®„Éú„Çø„É≥ÁÑ°ÂäπÂåñ
    document.querySelectorAll('.opt-btn').forEach(b => {
        b.onclick = null;
        if(b.innerText === correct) b.style.borderColor = 'var(--success)';
    });

    if (isCorrect) {
        score++;
        btn.style.backgroundColor = '#F6FFF9';
        mistakes = mistakes.filter(m => m.e !== q.e);
    } else {
        btn.style.borderColor = 'var(--error)';
        btn.style.backgroundColor = '#FFF6F6';
        if (!mistakes.some(m => m.e === q.e)) mistakes.push(q);
    }
    localStorage.setItem('mistakes', JSON.stringify(mistakes));

    document.getElementById('res').innerText = isCorrect ? "‚≠ï Ê≠£Ëß£ÔºÅ" : "‚ùå ‰∏çÊ≠£Ëß£";
    document.getElementById('res').style.color = isCorrect ? 'var(--success)' : 'var(--error)';
    document.getElementById('phrase').innerText = q.p;
    document.getElementById('fb').classList.add('show');
}

function nextQuestion() {
    currentIndex++;
    if (currentIndex < quizPool.length) {
        loadQuestion();
    } else {
        finishChapter();
    }
}

function finishChapter() {
    document.getElementById('quiz-screen').classList.add('hidden');
    document.getElementById('result-screen').classList.remove('hidden');
    document.getElementById('final-score').innerText = `${score} / ${quizPool.length}`;
    
    if (currentChapter !== 'Âæ©Áøí' && score === quizPool.length) {
        const today = new Date().toLocaleDateString('ja-JP');
        history[currentChapter] = today;
        localStorage.setItem('history', JSON.stringify(history));
    }
}

function speakCurrent() {
    const u = new SpeechSynthesisUtterance(quizPool[currentIndex].p);
    u.lang = 'en-US'; u.rate = 0.9;
    speechSynthesis.speak(u);
}

showMenu();
</script>
</body>
</html>
